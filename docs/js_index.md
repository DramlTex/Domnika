# JavaScript для Price/index.php

Этот документ описывает встроенный JavaScript в файле `index.php` и рекомендуемое разбиение кода на отдельные модули. Разделение позволит подключать сценарии по мере необходимости и упростит поддержку.

## Основные функции скрипта

1. **loadData** – загружает данные товаров через `fetch` и инициализирует таблицу.
2. **filterByUserFolders** – ограничивает набор товаров в соответствии с папками пользователя.
3. **groupProductsByCategory / createTabs / showTab** – группировка товаров и создание вкладок.
4. **fillTable** – постраничное заполнение таблицы товаров. Группирует записи по странам и, если внутри страны встречаются разные типы чая из колонки «Тип», добавляет строку-заголовок с названием типа.
5. **fillFilters** – формирование списков фильтров по типу и поставщику.
6. **applyFilters** – применение выбранных фильтров к текущему набору данных.
7. **openModal / closeModal** – показ увеличенного фото товара.
8. **formatStock / openProductModal / closeProductModal** – правая панель с подробностями о товаре.
9. **loadImageAsBase64** – вспомогательная функция для экспорта в Excel.
10. **cartChange / openCartModal / closeCartModal** – управление корзиной товаров.
11. **DOMContentLoaded** – точка входа: старт загрузки данных и привязка обработчиков.
12. **__groupedData / __currentGroup** – глобальные переменные с разбитыми по вкладкам данными и именем активной группы.

## Предлагаемая структура файлов

Для упорядочивания кода рекомендуется вынести каждую логическую группу в отдельный файл. Ниже приведён пример возможного разбиения. Имена файлов можно корректировать по вкусу, но содержание следует документировать с помощью JSDoc.

| Файл | Содержимое |
|------|------------|
|`data-loader.js`|Функции `loadData`, `filterByUserFolders` и `loadImageAsBase64`. Отвечает за получение данных и вспомогательные утилиты.|
|`tabs.js`|`groupProductsByCategory`, `createTabs` и `showTab`. Управление вкладками и группировкой товаров.|
|`table.js`|`fillTable` и `fillFilters`. Заполнение таблицы и подготовка выпадающих списков.|
|`filters.js`|`applyFilters` и инициализация полей фильтрации.|
|`modals.js`|`openModal`, `closeModal`, `openProductModal`, `closeProductModal`, а также `formatStock`. Работа с модальными окнами и панелью товара.|
|`export-excel.js`|Собирает `window.__productsData` и отправляет его POST-запросом на `export.php`.|
|`cart.js`|Функции работы с корзиной: хранение, изменение количества и модальное окно.|
|`main.js`|Событие `DOMContentLoaded`: загрузка данных, привязка кликов к кнопкам и элементам интерфейса. Подключает остальные модули.|

Каждый файл должен подключаться в `index.php` через отдельный тег `<script>` либо собираться в единый бандл. Внутри файлов используйте комментарии в формате JSDoc, чтобы описать назначение функций, параметры и возвращаемые значения.

При дальнейшем рефакторинге код можно перевести на ES6‑модули, импортируя нужные функции в `main.js`. Важно сохранить существующие id и классы элементов, чтобы разметка и стили продолжили работать без изменений.

## История изменений

- 2025-05-22 16:29 – создан документ `js_index.md` с описанием функций и структуры модулей.
- 2025-05-22 16:35 – JavaScript вынесен из `index.php` в отдельные файлы.

- 2025-05-22 17:10 Price/js/table.js – добавлена сортировка по странам и пример функции настройки порядка стран.
- 2025-05-26 12:20 docs/js_index.md – добавлено описание группировки типов чая внутри страны.

- 2025-05-22 17:20 Price/js/table.js – задан порядок стран и реализована алфавитная сортировка типов.
- 2025-05-22 17:28 Price/js/table.js – реализовано разделение товаров по типам внутри страны.

- 2025-05-22 18:22 docs/export_excel.md – добавлено описание механизма экспорта.
- 2025-05-23 08:42 Price/index.php, Price/js/cart.js – реализована клиентская корзина.
- 2025-05-23 09:30 Price/js/cart.js, Price/js/modals.js – ограничение количества запасом и ввод числа без спиннеров.
- 2025-05-30 13:10 Price/index.php, Price/js/cart.js – добавлена кнопка удаления позиции и убран крестик закрытия корзины.
- 2025-06-01 10:30 Price/js/cart.js – кнопка удаления теперь отображает значок корзины.
- 2025-05-23 12:45 Price/js/cart.js, Price/js/modals.js – добавлен выбор склада при добавлении в корзину.
- 2025-06-10 11:00 Price/js/cart.js – добавлена панель `cart-footer` с подсчётом суммы
  и кнопкой подтверждения заказа.

- 2025-06-20 09:30 Price/js/table.js, Price/data.php – колонка "Наличие в кг" теперь
  отображает только целые числа, позиции с нулевым остатком не выводятся.



