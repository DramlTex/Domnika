# Обзор PHP-скриптов

Этот документ описывает назначение всех PHP-файлов в проекте. Основная логика приложения распределена между CLI‑утилитами в корне репозитория и веб‑интерфейсом в каталоге `Price`.

## CLI‑скрипты

- **`product.php`** – загружает товары из API «МойСклад» и сохраняет отфильтрованный список в `output/filtered_products.json`. Используется для первоначального получения данных.
- **`output/update.php`** – добавляет недостающие упаковки (packs) товарам из `filtered_products.json` и отправляет изменения обратно в «МойСклад».
- **`webhook.php`** – обработчик вебхуков от «МойСклад». Сохраняет товары и модификации в `output/webhook_products.json`.
- **`output/init_db.php`** – загружает все товары и модификации из API и формирует начальный файл `output/webhook_products.json`.

## Каталог `Price`

В папке `Price` находится веб‑часть приложения. Здесь реализованы страницы входа, администрирования и сам прайс‑лист.

- **`index.php`** – основная страница прайс‑листа. Проверяет авторизацию, подключает стили и JavaScript‑модули, отображает таблицу товаров.
- **`auth.php`** – форма входа пользователей. Загружает данные из `users.json`, создаёт сессию и перенаправляет в зависимости от роли. При неудачном вводе использует POST/Redirect/GET, чтобы избежать повторной отправки формы.
- **`logout.php`** – завершает сессию и возвращает пользователя на страницу входа.
- **`admin.php`** – панель администратора. Доступна только при роли `admin`.
- **`data.php`** – API‑скрипт, который обращается к «МойСклад» и формирует JSON с товарами для фронтенда (подробности в [data.md](data.md)).
- **`export.php`** – экспорт прайс‑листа в Excel с использованием библиотеки PhpSpreadsheet.
- **`export1.php`** – предыдущая версия экспорта. Сохранена для совместимости.
- **`function.php`** – вспомогательные функции для чтения и записи `users.json`.
- **`image_proxy.php`** – проксирует запрос к изображению из «МойСклад», добавляя авторизационные заголовки.
- **`init.php`** – однократная инициализация администратора. Скрипт подключает `function.php` и формирует запись в `users.json`.
- **`config.php`** – возвращает логин и пароль для доступа к API.

`init.php` следует запускать через терминал командой `php Price/init.php`. Он один раз создаёт администратора в `users.json`.

## Каталог `Price/evt`

В директории `Price/evt` находится облегчённая версия веб‑интерфейса (страницы входа и простая выдача прайса). Файлы имеют те же названия, что и в основной папке (`admin.php`, `auth.php`, `data.php` и т.д.), но предназначены для демонстрационных мероприятий.

## Ссылки по теме

- [Документация по JavaScript](../js_index.md)
- [Описание CSS‑стилей](../css_index.md)
- [Процесс экспорта в Excel](../export_excel.md)

